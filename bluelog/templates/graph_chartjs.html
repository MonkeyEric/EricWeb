{% extends "base.html" %}
{% block title %}数据分析表{% endblock %}
{% block head %}
<link href="{{url_for('static',filename='layui/css/layui.css')}}" rel="stylesheet">
<link href="{{url_for('static',filename='layui/css/modules/code.css')}}" rel="stylesheet">
{% endblock %}
{% block wrapper%}
<div id="page-wrapper" class="gray-bg">
    {{self.pheader()}}
    <div class="row wrapper border-bottom white-bg page-heading" style="padding-top: 10px">
        <div class="col-lg-10">
            <h2>数据分析</h2>
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{{url_for('admin.index')}}">主页</a>
                </li>
                <li class="breadcrumb-item active">
                    <strong>echart分析</strong>
                </li>
            </ol>

        </div>
        <div class="col-lg-2">
            <div style="padding-top: 15px">

                <h2><strong>

            <input type="text" style="border-style: none; width: 60px" id="year_select">年

                </strong></h2><small style="color: darkgrey">数据日期</small>

            </div>

        </div>

    </div>

    <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-3">
            <div class="ibox">
                <div class="ibox-content">
                    <h5>存储</h5>
                    <h2 class="no-margins">￥886,200</h2>
                    <div class="stat-percent font-bold text-navy">98% <i class="fa fa-bolt"></i></div>

                </div>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="ibox">
                <div class="ibox-content">
                    <h5>上个月支出</h5>
                    <h2 class="no-margins">￥1 738,200</h2>
                    <div class="stat-percent font-bold text-navy">98% <i class="fa fa-bolt"></i></div>

                </div>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="ibox">
                <div class="ibox-content">
                    <h5>支出费用最高的类型</h5>
                     <h2 class="no-margins">54,200</h2>
                    <div class="stat-percent font-bold text-danger">24% <i class="fa fa-level-down"></i></div>



                </div>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="ibox">
                <div class="ibox-content">
                    <h5>支出次数最高的类型</h5>
                    <h2 class="no-margins">54,200</h2>
                    <div class="stat-percent font-bold text-danger">24% <i class="fa fa-level-down"></i></div>

                </div>
            </div>
        </div>

        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>消费总计</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link" href="">
                            <i class="fa fa-chevron-down"></i>
                        </a>
                        <a class="close-link" href="">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                  <div id="main2" style="height: 350px;"></div>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>消费类型总计</h5>
                        <div class="ibox-tools">
                        <a class="collapse-link" href="">
                            <i class="fa fa-chevron-down"></i>
                        </a>
                        <a class="close-link" href="">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                    </div>
                    <div class="ibox-content">
                     <div id="main3" style="height: 380px"></div>
                    </div>
                </div>
            </div>


        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>收入支出比</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link" href="">
                            <i class="fa fa-chevron-down"></i>
                        </a>
                        <a class="close-link" href="">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div id="main" style="height: 440px"></div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Top3消费类型折线图</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link" href="">
                            <i class="fa fa-chevron-down"></i>
                        </a>
                        <a class="close-link" href="">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>

                </div>
                <div class="ibox-content">
                    <div class="text-center">
                        <div id="main4" style="height: 370px"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Top5商品支付次数</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link" href="">
                            <i class="fa fa-chevron-down"></i>
                        </a>
                        <a class="close-link" href="">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>

                </div>
                <div class="ibox-content">
                    <div class="text-center">
                        <div id="main5" style="height: 370px"></div>
                    </div>
                </div>
            </div>
        </div>


    </div>
    </div>


    {{self.footer()}}
</div>
{% endblock%}
{%block script%}
<script src="{{url_for('static',filename='js/echarts.js')}}"></script>
<script src="{{url_for('static',filename='layui/layui.js')}}"></script>
<script type="text/javascript">
    // SKIN Select
        $('.spin-icon').click(function () {
            $(".theme-config-box").toggleClass("show");
        });
    var now = new Date();
    year_select.value=new Date().getFullYear();

    //回到顶部
        function goTop(){
            $('html,body').animate({'scrollTop':0},600);
        }

   $(function (){
       //右侧导航栏，只用到jquery-2.0.3.min
        $(".side ul li").hover(function(){
        $(this).find(".sidebox").stop().animate({"width":"124px"},200).css({"opacity":"1","filter":"Alpha(opacity=100)","background":"#ae1c1c"})
        },function(){
        $(this).find(".sidebox").stop().animate({"width":"54px"},200).css({"opacity":"0.8","filter":"Alpha(opacity=80)","background":"#000"})
        });


        $("#income a").click()
        $("#nine").addClass('active')
       layui.use('laydate', function(){
           var laydate = layui.laydate;
           //年选择器
          laydate.render({
            elem: '#year_select'
            ,type: 'year'
              ,theme:'#393D49'
          });
       })

       // 每个月的收入指出比
        var chartDom1 = document.getElementById('main');
        var myChart1 = echarts.init(chartDom1, 'dark');
        var option1;

        option1 = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {
            data: ['利润', '支出', '收入']
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: [
            {
                type: 'value'
            }
        ],
        yAxis: [
            {
                type: 'category',
                axisTick: {
                    show: false
                },
                data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日']
            }
        ],
        series: [
            {
                name: '利润',
                type: 'bar',
                label: {
                    show: true,
                    position: 'inside'
                },
                emphasis: {
                    focus: 'series'
                },
                data: [200, 170, 240, 244, 200, 220, 210]
            },
            {
                name: '收入',
                type: 'bar',
                stack: '总量',
                label: {
                    show: true
                },
                emphasis: {
                    focus: 'series'
                },
                data: [320, 302, 341, 374, 390, 450, 420]
            },
            {
                name: '支出',
                type: 'bar',
                stack: '总量',
                label: {
                    show: true,
                    position: 'left'
                },
                emphasis: {
                    focus: 'series'
                },
                data: [-120, -132, -101, -134, -190, -230, -210]
            }
        ]
        };

        option1 && myChart1.setOption(option1);


        //每个月的
        var chartDom = document.getElementById('main2');
        var myChart = echarts.init(chartDom, 'dark');
        var option;

        var dataMap = {};
        function dataFormatter(obj) {
            var pList = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
            var temp;
            for (var year = 2018; year <= 2028; year++) {
                var max = 0;
                var sum = 0;
                temp = obj[year];
                for (var i = 0, l = temp.length; i < l; i++) {
                    max = Math.max(max, temp[i]);
                    sum += temp[i];
                    obj[year][i] = {
                        name : pList[i],
                        value : temp[i]
                    }
                }
                obj[year + 'max'] = Math.floor(max / 100) * 100;
                obj[year + 'sum'] = sum;
            }
            return obj;
        }
        dataMap.databar = dataFormatter({
            2018:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3],
            2019:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3],
            2020:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3],
            2021:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2022:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2023:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2024:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2025:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2026:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2027:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],
            2028:[12.0, 43.9, 47.0, 43.2, 15.6, 66.7, 135.6, 162.2, 9.6, 80.0, 62.4, 72.3],

        });
        dataMap.dataline = dataFormatter({

            2018:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2019:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2020:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2021:[12.0, 22.2, 33.3, 44.5, 56.3, 10.2, 20.3, 33.4, 23.0, 66.5, 62.0, 86.2],
            2022:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2023:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2024:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2025:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2026:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2027:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],
            2028:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2],

        });


        option = {
            baseOption: {
                timeline: {
                    axisType: 'category',
                    // realtime: false,
                    // loop: false,
                    autoPlay: true,
                    // currentIndex: 2,
                    playInterval: 1000,
                    // controlStyle: {
                    //     position: 'left'
                    // },
                    data: [
                        '2018-01-01','2019-01-01','2020-01-01',
                        {
                            value: '2021-01-01',
                            tooltip: {
                                formatter: '{b} 达到自己的目标'
                            },
                            symbol: 'diamond',
                            symbolSize: 16
                        },
                        '2022-01-01', '2023-01-01','2024-01-01','2025-01-01','2026-01-01',
                        {
                            value: '2027-01-01',
                            tooltip: {
                                formatter: function (params) {
                                    return params.name + 'GDP达到又一个高度';
                                }
                            },
                            symbol: 'diamond',
                            symbolSize: 18
                        },
                        '2028-01-01'
                    ],
                    label: {
                        formatter : function(s) {
                            return (new Date(s)).getFullYear();
                        }
                    }
                },
                title: {
                    subtext: '数据来自真实案例'
                },
                tooltip: {},
                legend: {
                    left: 'center',
                    data: ['金额', '次数'],

        },
        calculable : true,
        grid: {
            top: 80,
            bottom: 100
        },
        xAxis: [
            {
                'type':'category',
                'axisLabel':{'interval':0},
                'data':[
                    '1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'
                ],
                splitLine: {show: false}
            }
        ],
        yAxis: [
            {
                type: 'value',
                name: '金额（元）',
                // max: 53500
                max: 100
            },
            {
                type: 'value',
                name: '次数',
                // max: 53500
                max: 50,
                interval: 5
            }
        ],
        series: [
            {name: '金额', type: 'bar'},
            {name: '次数', type: 'line'},
        ]
        },
        options:[
            {
            title: {text: '2018年个人支出分析'},
            series: [
                {data: dataMap.databar['2018']},
                {data: dataMap.dataline['2018']},
            ]
        },
            {
            title: {text: '2019年个人支出分析'},
            series: [
                {data: dataMap.databar['2019']},
                {data: dataMap.dataline['2019']},
            ]
        },
            {
            title: {text: '2020年个人支出分析'},
            series: [
                {data: dataMap.databar['2020']},
                {data: dataMap.dataline['2020']},
            ]
        },
            {
            title: {text: '2021年个人支出分析'},
            series: [
                {data: dataMap.databar['2021']},
                {data: dataMap.dataline['2021']},
            ]
        },
            {
            title: {text: '2022年个人支出分析'},
            series: [
                {data: dataMap.databar['2022']},
                {data: dataMap.dataline['2022']},
            ]
        },
            {
            title: {text: '2023年个人支出分析'},
            series: [
                {data: dataMap.databar['2023']},
                {data: dataMap.dataline['2023']},
            ]
        },
            {
            title: {text: '2024年个人支出分析'},
            series: [
                {data: dataMap.databar['2024']},
                {data: dataMap.dataline['2024']},
            ]
        },
            {
            title: {text: '2025年个人支出分析'},
            series: [
                {data: dataMap.databar['2025']},
                {data: dataMap.dataline['2025']},
            ]
        },
             {
            title: {text: '2026年个人支出分析'},
            series: [
                {data: dataMap.databar['2026']},
                {data: dataMap.dataline['2026']},
            ]
        },
             {
            title: {text: '2027年个人支出分析'},
            series: [
                {data: dataMap.databar['2027']},
                {data: dataMap.dataline['2027']},
            ]
        },
             {
            title: {text: '2028年个人支出分析'},
            series: [
                {data: dataMap.databar['2028']},
                {data: dataMap.dataline['2028']},
            ]
        },
        ],







        // tooltip: {
        // trigger: 'axis',
        // axisPointer: {
        //     type: 'cross',
        //     crossStyle: {
        //         color: '#999'
        //     }
        // }
        // },
        // toolbox: {
        // feature: {
        //
        //     magicType: {show: true, type: ['line', 'bar']},
        //     restore: {show: true},
        //     saveAsImage: {show: true}
        // }
        // },
        // legend: {
        // data: ['金额',  '次数']
        // },
        // xAxis: [
        // {
        //     type: 'category',
        //     data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
        //     axisPointer: {
        //         type: 'shadow'
        //     }
        // }
        // ],
        // yAxis: [
        // {
        //     type: 'value',
        //     name: '金额',
        //     min: 0,
        //     max: 250,
        //     interval: 50,
        //     axisLabel: {
        //         formatter: '￥{value}'
        //     }
        // },
        // {
        //     type: 'value',
        //     name: '次数',
        //     min: 0,
        //     max: 25,
        //     interval: 5,
        //     axisLabel: {
        //         formatter: '消费{value}次'
        //     }
        // }
        // ],
        // series: [
        // {
        //     name: '金额',
        //     type: 'bar',
        //     data: [2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
        // },
        // {
        //     name: '次数',
        //     type: 'line',
        //     yAxisIndex: 1,
        //     data: [2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2]
        // }
        // ]
        };

        option && myChart.setOption(option);


        //消费类型

        var chartDom2 = document.getElementById('main3');
        var myChart3 = echarts.init(chartDom2, 'dark');
        var option3;

        option3 = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // Use axis to trigger tooltip
                type: 'shadow'        // 'shadow' as default; can also be 'line' or 'shadow'
            }
        },
        legend: {
            data: ['Direct', 'Mail Ad', 'Affiliate Ad', 'Video Ad', 'Search Engine']
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'value'
        },
        yAxis: {
            type: 'category',
            data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
        },
        series: [
            {
                name: 'Direct',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true
                },
                emphasis: {
                    focus: 'series'
                },
                data: [320, 302, 301, 334, 390, 330, 320]
            },
            {
                name: 'Mail Ad',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true
                },
                emphasis: {
                    focus: 'series'
                },
                data: [120, 132, 101, 134, 90, 230, 210]
            },
            {
                name: 'Affiliate Ad',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true
                },
                emphasis: {
                    focus: 'series'
                },
                data: [220, 182, 191, 234, 290, 330, 310]
            },
            {
                name: 'Video Ad',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true
                },
                emphasis: {
                    focus: 'series'
                },
                data: [150, 212, 201, 154, 190, 330, 410]
            },
            {
                name: 'Search Engine',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true
                },
                emphasis: {
                    focus: 'series'
                },
                data: [820, 832, 901, 934, 1290, 1330, 1320]
            }
        ]
        };

        option3 && myChart3.setOption(option3);

        // top3的费用情况
    var chartDom4 = document.getElementById('main4');
    var myChart4 = echarts.init(chartDom4, 'dark');
    var option4;

    option4 = {
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data: ['邮件营销', '联盟广告', '视频广告', '直接访问', '搜索引擎']
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        toolbox: {
            feature: {
                saveAsImage: {}
            }
        },
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日']
        },
        yAxis: {
            type: 'value'
        },
        series: [
            {
                name: '邮件营销',
                type: 'line',
                stack: '总量',
                 radius: '80%',
                data: [120, 132, 101, 134, 90, 230, 210]
            },
            {
                name: '联盟广告',
                type: 'line',
                stack: '总量',
                 radius: '80%',
                data: [220, 182, 191, 234, 290, 330, 310]
            },
            {
                name: '视频广告',
                type: 'line',
                stack: '总量',
                 radius: '80%',
                data: [150, 232, 201, 154, 190, 330, 410]
            },
            {
                name: '直接访问',
                type: 'line',
                stack: '总量',
                 radius: '80%',
                data: [320, 332, 301, 334, 390, 330, 320]
            },
            {
                name: '搜索引擎',
                type: 'line',
                stack: '总量',
                 radius: '80%',
                data: [820, 932, 901, 934, 1290, 1330, 1320]
            }
        ]
    };

    option4 && myChart4.setOption(option4);

    //top3
    var chartDom5 = document.getElementById('main5');
    var myChart5 = echarts.init(chartDom5, 'dark');
    var option5;

    option5 = {

    tooltip: {
    trigger: 'item'
    },
    legend: {
        top: '5%',
        left: 'center'
    },
    series: [
    {
        name: '访问来源',
        type: 'pie',
        radius: '70%',
        data: [
            {value: 1048, name: '搜索引擎'},
            {value: 735, name: '直接访问'},
            {value: 580, name: '邮件营销'},
            {value: 484, name: '联盟广告'},
            {value: 300, name: '视频广告'}
        ],
        emphasis: {
            itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
        }
    }
    ]
    };

    option5 && myChart5.setOption(option5);

        })



</script>
{% endblock%}
